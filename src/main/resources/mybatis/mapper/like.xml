<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="like">
	<select id ="selectList" parameterType="map" resultType="map">
			SELECT     p.product_id, product_name, price, size, quality,
          			   deal_means, safe_deal, seller_uid, update_date,
           		       selling_status, i.img_url, c.category_name, m.user_name, m.user_rank
      		 FROM      tbl_product p 
  LEFT OUTER JOIN      (SELECT product_id, img_url FROM tbl_product_img WHERE img_main = 1) i
        	   ON      i.product_id = p.product_id, tbl_category c, tbl_member m
            WHERE      p.category_id = c.category_id
		      AND      p.seller_uid = m.uid
		      		   <if test="brandId != null and brandId !='brand-all'">
				       		AND	p.brand_id =#{brandId}
				       </if>
				       <if test="searchValue != null and searchValue != ''">
				       		AND p.product_name LIKE CONCAT('%', #{searchValue}, '%')
				       </if>
				       <if test="seriesId != null and seriesId != 'series-all'">
				       		AND p.series_id = #{seriesId} 
				       </if>
				       <if test="categoryId != null and categoryId != 'category-all'">
				       		AND p.category_id = #{categoryId} 
				       </if>
					   <if test="sizeId != null and sizeId != 'size-all'">
				       		AND p.size = #{sizeId} 
				       </if>
				       <if test="qualityId != null and qualityId != 'quality-all'">
				       		AND p.quality = #{qualityId} 
				       </if>     
         ORDER BY 
					   <choose>
							<when test="priceFilter == 'ASC'">
								p.price ASC,
							</when>
							<when test="priceFilter == 'DESC'">
								p.price DESC,
							</when>
					   </choose>
				update_date DESC
		LIMIT  #{firstIndex}, #{rowsPerPage}
	</select>

	<select id ="selectCount" parameterType="map" resultType="int">
			SELECT     COUNT(product_id) AS list_count
      		 FROM      tbl_product
      	    WHERE	   product_id != "0"
      	    		   <if test="brandId != null and brandId !='brand-all'">
				       		AND	brand_id =#{brandId}
				       </if>
				       <if test="searchValue != null and searchValue != ''">
				       		AND product_name LIKE CONCAT('%', #{searchValue}, '%')
				       </if>
				       <if test="seriesId != null and seriesId != 'series-all'">
				       		AND series_id = #{seriesId} 
				       </if>
				       <if test="categoryId != null and categoryId != 'category-all'">
				       		AND category_id = #{categoryId} 
				       </if>
					   <if test="sizeId != null and sizeId != 'size-all'">
				       		AND size = #{sizeId} 
				       </if>
				       <if test="qualityId != null and qualityId != 'quality-all'">
				       		AND quality = #{qualityId} 
				       </if>
	</select>

	<select id="countLike" parameterType="string" resultType="int">
		SELECT COUNT(product_id) AS countLike
		  FROM tbl_like
       	 WHERE product_id = #{productId}
	</select>

	<select id="hasLike" parameterType="map" resultType="int">
		SELECT COUNT(product_id) AS countLike
		  FROM tbl_like
       	 WHERE product_id = #{productId}
       	   AND uid = #{uid}
	</select>

	<insert id="addLike" parameterType="map">
		INSERT INTO tbl_like
  			(product_id, uid)
  		VALUES
  			(#{productId}, #{uid})
	</insert>
	
	<delete id="delete" parameterType="map">
		DELETE FROM tbl_like
		 WHERE product_id = #{productId}
		   AND uid = #{uid}
	</delete>
	
	<delete id="deleteProduct" parameterType="string">
		DELETE FROM tbl_like
			  WHERE product_id =#{productId}
	</delete>
	
</mapper>